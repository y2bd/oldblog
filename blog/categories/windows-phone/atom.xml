<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: windows phone | this has yet to be defined]]></title>
  <link href="http://y2bd.github.io/blog/categories/windows-phone/atom.xml" rel="self"/>
  <link href="http://y2bd.github.io/"/>
  <updated>2014-01-30T14:30:15-08:00</updated>
  <id>http://y2bd.github.io/</id>
  <author>
    <name><![CDATA[y2bd]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Ordering voice commands on the "Did You Know?" page]]></title>
    <link href="http://y2bd.github.io/blog/2014/01/30/ordering-voice-commands-on-the-did-you-know-page/"/>
    <updated>2014-01-30T14:05:00-08:00</updated>
    <id>http://y2bd.github.io/blog/2014/01/30/ordering-voice-commands-on-the-did-you-know-page</id>
    <content type="html"><![CDATA[<p>Just a small tip for a small problem I ran into.</p>

<p>If your WP app has voice commands defined, you&rsquo;ll get a &ldquo;Did You Know?&rdquo; page where the user can see examples of all of the
voice commands your app has. If you have a lot of voice commands available, it might get a bit messy.</p>

<p><img src="/images/posts/didyouknow.png" title="&lsquo;There\&rsquo;s no sense of order at all!&rsquo;" ></p>

<p>What&rsquo;s more confusing is that the order of the commands on this page probably won&rsquo;t match up with the order
you defined them in your VCD file.</p>

<p>It turns out that they&rsquo;re displayed in alphabetical order, with the key being the <code>Name</code> attribute of your <code>Command</code> object, which means that you can adjust your names to order them how you want, perhaps by prepending them with letters or numbers.</p>

<p>In my particular case, that means that my commands would go from</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;Command</span> <span class="na">Name=</span><span class="s">&quot;SearchPokemon&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;Command</span> <span class="na">Name=</span><span class="s">&quot;SearchMoves&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;Command</span> <span class="na">Name=</span><span class="s">&quot;SearchTypes&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;Command</span> <span class="na">Name=</span><span class="s">&quot;SearchDualTypes&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>to the following with numbered prefixes</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;Command</span> <span class="na">Name=</span><span class="s">&quot;00_SearchPokemon&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;Command</span> <span class="na">Name=</span><span class="s">&quot;01_SearchMoves&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;Command</span> <span class="na">Name=</span><span class="s">&quot;02_SearchTypes&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;Command</span> <span class="na">Name=</span><span class="s">&quot;03_SearchDualTypes&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>If you plan on inserting more commands later on, you&rsquo;ll have to rename older ones to get the order you want, so I&rsquo;d recommend using <code>string.Contains("base-name-of-command")</code> rather than equality checks in your code so that even if the prefix changes, your code will still work without having to do a million find-and-replaces.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rendering Image Sources with the Nokia Imaging SDK]]></title>
    <link href="http://y2bd.github.io/blog/2013/09/15/rendering-bitmapimages-with-the-nokia-imaging-sdk/"/>
    <updated>2013-09-15T14:04:00-07:00</updated>
    <id>http://y2bd.github.io/blog/2013/09/15/rendering-bitmapimages-with-the-nokia-imaging-sdk</id>
    <content type="html"><![CDATA[<p><strong>Edit</strong>: After some searching, I&rsquo;ve found the Nokia-Certified&trade; method of rendering to a BitmapImage/ImageSource.</p>

<p>First of all, Image controls can surprisingly take a WriteableBitmap as their source. You can do this:</p>

<p>``` csharp</p>

<p>BindedImageSource = new WriteableBitmap(1024,768);</p>

<p>```</p>

<p>and everything will be fine.</p>

<p>Second, remember how <code>IEditingSession</code> has a <code>RenderToWriteableBitmap()</code> method?</p>

<p>``` csharp</p>

<p>var myWBP = new WriteableBitmap(1024, 768);</p>

<p>await _session.RenderToWriteableBitmapAsync(myWBP);</p>

<p>myWBP.Invalidate(); // forces a redraw</p>

<p>BindedImageSource = myWBP;</p>

<p>```</p>

<p>An interesting side-note is that RenderToWriteableBitmap appears to be shorthand for</p>

<p>``` csharp</p>

<p>var bitmap = myWBP.AsBitmap();
await _session.RenderToBitmapAsync(bitmap);</p>

<p>```</p>

<p><code>bitmap</code> in this example is not a typical Bitmap, but a <a href="http://developer.nokia.com/Resources/Library/Imaging_API_Ref/#!nokiainteropserviceswindowsruntime-namespace/writeablebitmapextensions-class/writeablebitmapextensions-methods/asbitmap-method.html">mysterious object that wraps a WriteableBitmap&rsquo;s pixel data</a>. That means that changes to this bitmap <strong>affect the original WriteableBitmap</strong>. Now extracting it isn&rsquo;t very helpful in this small example, but if you check out the code for <a href="http://developer.nokia.com/Resources/Library/Lumia/#!nokia-imaging-sdk/sample-projects/filter-effects.html">Nokia&rsquo;s Filter Effects sample</a> (spefically checkout the <code>AbstractFilter</code> class) you can do some pretty neat things without having to create a new WriteableBitmap each time.</p>

<p>I&rsquo;ll keep the original post below for context.</p>

<hr />

<p>So I was working on integrating the Nokia Imaging SDK for my journal app, <a href="http://blog.y2bd.me/sofa/">Sofa</a>, for the <a href="http://developer.nokia.com/create/">Nokia Create contest</a>, essentially letting the user crop and enhance their photos before attaching them to an entry.</p>

<p>I found myself using the SDK in my ViewModel and wondering how I was supposed to get the rendered image into my View. The SDK itself provides methods for rendering to JPEG, raw Bitmaps, WriteableBitmaps, and even Image controls. The Image controls option (<code>renderToImageAsync()</code>) sounded like the way to go, but I realized that in the VM I don&rsquo;t have access to the Image control in my view. Instead, I have access to a BitmapImage that binds to the Source property of the Image control. So how do you get a BitmapImage out of the editing session?</p>

<p>Well after some searching I found that you can coax a BitmapImage out of a WriteableBitmap. Here&rsquo;s an extension method that lets you do exactly that:</p>

<p>``` csharp
public static async Task<BitmapImage> RenderToBitmapImageAsync(this IEditingSession session, int width, int height, OutputOption outputOption = OutputOption.PreserveAspectRatio)
{
  var bi = new BitmapImage();</p>

<p>  var wbp = new WriteableBitmap(width, height);
  await session.RenderToWriteableBitmapAsync(wbp, outputOption);</p>

<p>  using (var ms = new MemoryStream())
  {</p>

<pre><code>wbp.SaveJpeg(ms, width, height, 0, 100);
bi.SetSource(ms);
</code></pre>

<p>  }</p>

<p>  // not super necessary
  wbp = null;</p>

<p>  return bi;
}
```</p>

<p>Just put this into a static class (perhaps an Extensions.cs?) and then call</p>

<p><code>csharp
myBindedImage = await _myEditSession.RenderToBitmapImageAsync(someWidth, someHeight, outputOptionIfYouWant);
</code></p>

<p>Note that <a href="https://www.google.com/search?q=writeablebitmap+memory+leak">there may be memory issues with WriteableBitmaps</a>, so be wary of calling this often, especially with high widths and heights. You may need to force garbage collection after a few calls.</p>

<p>Because of that, I&rsquo;m definitely not 100% keen on this method. It definitely works (wait for Sofa v1.1 to prove that) but I&rsquo;ll be on the lookout for less memory-intensive options.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sofa is done!]]></title>
    <link href="http://y2bd.github.io/blog/2013/09/09/sofa-is-done/"/>
    <updated>2013-09-09T21:26:00-07:00</updated>
    <id>http://y2bd.github.io/blog/2013/09/09/sofa-is-done</id>
    <content type="html"><![CDATA[<p><img src="/images/posts/sofa.png" title="&lsquo;The read, new, and photos views.&rsquo;" ></p>

<p>It&rsquo;s been almost two months now, but Sofa, my journal application for Windows Phone 8, is finally done!</p>

<p>First of all, the last time I referred to Sofa I called it &lsquo;Quill&rsquo;. That was its work-in-progress name, but I had to change it because I couldn&rsquo;t find a nice quill vector to use as the main logo. No problem, Sofa was actually how I referred to the app within the code anyway, and it&rsquo;s still a nice title. Maybe I&rsquo;ll use Quill for something else&hellip;</p>

<p>This is easily the biggest programming project (hell, maybe even general project) that I&rsquo;ve worked on, and I&rsquo;ve learned a <em>ton</em> since I started. I now have a much better grip on Git, and by that I mean I know more than <code>git commit -am "Did stuff"</code> and <code>git push origin master</code>. I learned more about branching, merging, stashing (ran into a nasty problem with that), and am currently learning about rebasing because I have way too many one-line-changed commits.</p>

<p>I&rsquo;ve also learned a lot more about the tools and libraries I&rsquo;ve been using in my small WP dev &lsquo;career&rsquo;. From the Windows Phone Toolkit (which I ended up having to fork to fix a bug), to MVVMLight (minimal code-behind, I promise!), to new tools like SQLite and Microsoft&rsquo;s LiveSDK (for SkyDrive integration, need those bullet-point features).</p>

<p>I <em>think</em> I&rsquo;ve also learned to finally accept a v1 product&mdash;there are tons of features that I want for Sofa, but I needed to realize that if I spend way too much time trying to perfect it, I&rsquo;ll fall into my trap of getting frustrated, getting bored, and then giving up on it altogether (I have enough half-finished VS solutions to show the effects of this).</p>

<p>The last week and a half have been spent with some <em>awesome</em> beta testers who have been extremely helpful in finding bugs, little quirks, and feature suggestions. I am definitely having beta periods for all of my serious apps from now on.</p>

<p>Sofa has been in the approval process for the last two days and you wouldn&rsquo;t believe how nervous I am. Every morning I wake up, scramble to my phone, and falter, looking at that mail icon with a number next to it. I&rsquo;ve gotten &ldquo;Certification Failed&rdquo; for my other apps before (Dammit Pinned, get along with the budget phones!), and I really don&rsquo;t want that to happen now. There&rsquo;s two weeks until I have to move back to Southern California for college, and I have no idea what kind of free time I&rsquo;ll have once that happens.</p>

<p>Wish me luck!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My multiline Textbox configuration]]></title>
    <link href="http://y2bd.github.io/blog/2013/08/27/my-multiline-textbox-configuration/"/>
    <updated>2013-08-27T20:04:00-07:00</updated>
    <id>http://y2bd.github.io/blog/2013/08/27/my-multiline-textbox-configuration</id>
    <content type="html"><![CDATA[<p>I&rsquo;m still working on Quill, but I figured this construct was useful enough for me to save in its
purest form, before I uglify it with orientation hacks.</p>

<p>This is an implementation of a properly-behaving multiline TextBox for Windows Phone. The original implementation
was sourced from <a href="http://klingdigital.net/2013/06/scrollviewer-and-multiline-textbox-windowsphone">KlingDigital</a>.
I just made extremely minor modifications, mostly refactoring to make it easier to modify (adding an input scope,
supporting landscape, etc).</p>

<p>Here is the XAML:</p>

<p>``` xml
&lt;phone:PhoneApplicationPage</p>

<pre><code>x:Class="Autocomplete.MainPage"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"
xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
mc:Ignorable="d"
FontFamily="{StaticResource PhoneFontFamilyNormal}"
FontSize="{StaticResource PhoneFontSizeNormal}"
Foreground="{StaticResource PhoneForegroundBrush}"
SupportedOrientations="Portrait" Orientation="Portrait"
shell:SystemTray.IsVisible="True"
Loaded="PhoneApplicationPage_Loaded"&gt;

&lt;!--LayoutRoot is the root grid where all page content is placed--&gt;
&lt;Grid x:Name="LayoutRoot" Background="Transparent"&gt;
    &lt;Grid.RowDefinitions&gt;
        &lt;RowDefinition/&gt;
        &lt;RowDefinition Height="Auto" /&gt;
    &lt;/Grid.RowDefinitions&gt;

    &lt;ScrollViewer x:Name="Scroller"
                  Background="#1ba1e2"
                  Grid.Row="0"&gt;
        &lt;StackPanel VerticalAlignment="Top"&gt;
            &lt;TextBox x:Name="ScrollerInput"
                     TextWrapping="Wrap"
                     AcceptsReturn="True" 
                     TextChanged="ScrollerInput_TextChanged"
                     GotFocus="ScrollerInput_GotFocus"
                     LostFocus="ScrollerInput_LostFocus"
                     Tap="ScrollerInput_Tap"/&gt;
        &lt;/StackPanel&gt;
    &lt;/ScrollViewer&gt;

    &lt;Grid x:Name="KeyboardPlaceholder"
          Grid.Row="1"
          Visibility="Collapsed" /&gt;
&lt;/Grid&gt;    
</code></pre>

<p>&lt;/phone:PhoneApplicationPage>
```</p>

<p>and here is the codebehind:</p>

<p>``` csharp
using Microsoft.Phone.Controls;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Media;</p>

<p>namespace Autocomplete
{
  public partial class MainPage : PhoneApplicationPage
  {</p>

<pre><code>private const int PortraitHeight = 336;

private double _inputHeight = 0;
private double _tapHeight = 0;

// Constructor
public MainPage()
{
  InitializeComponent();
}

private void SizePlaceholder()
{
  KeyboardPlaceholder.Height = PortraitHeight;
}

private void ForceLayout()
{
  App.RootFrame.RenderTransform = new CompositeTransform();

  LayoutRoot.UpdateLayout();
}

private void PhoneApplicationPage_Loaded(object sender, RoutedEventArgs e)
{

}

private void ScrollerInput_TextChanged(object sender, TextChangedEventArgs e)
{
  // updates seem to be late if we don't invoke them with the dispatcher
  Dispatcher.BeginInvoke(() =&gt;
  {
    double currentInputHeight = ScrollerInput.ActualHeight;

    if (currentInputHeight &gt; _inputHeight)
    {
      // scroll up by the difference between the current box size and the old box size
      Scroller.ScrollToVerticalOffset(Scroller.VerticalOffset + currentInputHeight - _inputHeight);
    }

    _inputHeight = currentInputHeight;
  });
}

private void ScrollerInput_GotFocus(object sender, RoutedEventArgs e)
{
  KeyboardPlaceholder.Visibility = Visibility.Visible;
  SizePlaceholder();

  ForceLayout();

  Scroller.ScrollToVerticalOffset(_tapHeight);
}

private void ScrollerInput_LostFocus(object sender, RoutedEventArgs e)
{
  KeyboardPlaceholder.Visibility = Visibility.Collapsed;
}

private void ScrollerInput_Tap(object sender, System.Windows.Input.GestureEventArgs e)
{
  _tapHeight = e.GetPosition(ScrollerInput).Y - 120;
}
</code></pre>

<p>  }
}
```</p>

<p>Hopefully this template will prove useful in the future.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fixing alignment issues with DataTemplateSelector]]></title>
    <link href="http://y2bd.github.io/blog/2013/08/16/fixing-alignment-issues-with-datatemplateselector/"/>
    <updated>2013-08-16T19:24:00-07:00</updated>
    <id>http://y2bd.github.io/blog/2013/08/16/fixing-alignment-issues-with-datatemplateselector</id>
    <content type="html"><![CDATA[<p>I&rsquo;m currently working on a journaling application for WP8. While designing the page for browsing through past entries, I found that I needed to be able to switch between data templates for the <code>LongListSelector</code> housed in the page. Some journal entries would have just text, some would have only a header photo, and some would have both, and I needed to display the entries differently for all three cases.</p>

<p>I found <a href="http://www.geekchamp.com/articles/implementing-windows-phone-7-datatemplateselector-and-customdatatemplateselector">this article</a> describing how to recreate WPF&rsquo;s <code>DataTemplateSelector</code> class for Windows Phone. It worked fine&mdash;after remaking the base abstract class and extending it for my specific case, all you need to do is specify the different data templates in your xaml:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;DataTemplate</span> <span class="na">x:Key=</span><span class="s">&quot;EntryListItemTemplate&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="ni">&amp;lt;</span>sel:EntryItemTemplateSelector&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>sel:EntryItemTemplateSelector.Both<span class="ni">&amp;gt;</span>
</span><span class='line'>  <span class="ni">&amp;lt;</span>DataTemplate<span class="ni">&amp;gt;</span> <span class="ni">&amp;lt;</span>!-- content here --<span class="ni">&amp;gt;</span> <span class="ni">&amp;lt;</span>/DataTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/sel:EntryItemTemplateSelector.Both<span class="ni">&amp;gt;</span>
</span><span class='line'>
</span><span class='line'><span class="ni">&amp;lt;</span>sel:EntryItemTemplateSelector.OnlyImage<span class="ni">&amp;gt;</span>
</span><span class='line'>  <span class="ni">&amp;lt;</span>DataTemplate<span class="ni">&amp;gt;</span> <span class="ni">&amp;lt;</span>!-- content here --<span class="ni">&amp;gt;</span> <span class="ni">&amp;lt;</span>/DataTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/sel:EntryItemTemplateSelector.OnlyImage<span class="ni">&amp;gt;</span>
</span><span class='line'>
</span><span class='line'><span class="ni">&amp;lt;</span>sel:EntryItemTemplateSelector.OnlyText<span class="ni">&amp;gt;</span>
</span><span class='line'>  <span class="ni">&amp;lt;</span>DataTemplate<span class="ni">&amp;gt;</span> <span class="ni">&amp;lt;</span>!-- content here --<span class="ni">&amp;gt;</span> <span class="ni">&amp;lt;</span>/DataTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/sel:EntryItemTemplateSelector.OnlyText<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>  <span class="ni">&amp;lt;</span>/sel:EntryItemTemplateSelector&gt;
</span><span class='line'><span class="nt">&lt;/DataTemplate&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>A bit verbose, but it got the job done thankfully. The LongListSelector would now switch between templates as required.</p>

<p>There was a bit of a problem though.</p>

<p><img src="/images/posts/centered.png" title="&lsquo;All of the elements are centered and small!&rsquo;" ></p>

<p>Mordecai has the right idea.</p>

<p>All of the elements in the LongListSelector were no longer listening to the standard alignment and sizing rules, instead being only as wide as their content and staying put in the center.</p>

<p>I tried adjusting margins, hardcoding widths, <code>HorizontalAlignment=Stretch</code> <em>everything</em>, and either it wouldn&rsquo;t work, or it would make things even worse.</p>

<p>After a lot of vague googling (what exactly would you call this problem? I honestly had no idea), I arrove at the correct solution. My <code>EntryItemTemplateSelector</code>, inheriting from <code>ContentControl</code>, has a new property named <code>HorizontalContentAlignment</code>, which <a href="http://msdn.microsoft.com/en-us/library/system.windows.controls.control.horizontalcontentalignment.aspx">sets the alignment of the control&rsquo;s <em>content</em> rather than the control itself</a>. So all you have to do then is</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="ni">&amp;lt;</span>sel:EntryItemTemplateSelector HorizontalContentAlignment=<span class="ni">&amp;ldquo;</span>Stretch<span class="ni">&amp;rdquo;</span>&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>which gets you</p>

<p><img src="/images/posts/aligned.png" title="&lsquo;Now every element is taking up the correct amount of space!&rsquo;" ></p>

<p>Nothing satisfies Mordecai though.</p>
]]></content>
  </entry>
  
</feed>
